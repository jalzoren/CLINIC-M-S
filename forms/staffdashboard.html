<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard / PLP Clinic Monitoring System</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../css/dashbstyle.css">
    <link rel="icon" type="image/png" href="/pictures/logo.png">

</head>
<body>
    <div class="sidebar">
        <div class="logo-content">
            <div class="logo" id="logo">
                <img src="../pictures/logo.png" alt="Logo" class="logo-img">
                <div class="logo-name">PLPClinic</div>
            </div>
        </div>

        <ul class="nav-list">
            <li>
                <a href="../forms/dashboard.html" class="active" class="transition-link">
                <i class='bx bxs-grid-alt bx-rotate-180' ></i>
                <span class="link-name">Dashboard</span>
                </a>
                <span class="tooltip">Dashboard</span>
            </li>

            <li>
                <a href="../forms/medrecords.html" class="transition-link">
                <i class='bx bxs-file' ></i>               
                <span class="link-name">Medical</span>
                </a>
                <span class="tooltip">Medical Records</span>
            </li>
            <li>
                <a href="../forms/borrowing.html" class="transition-link">
                <i class='bx bxs-cabinet'></i>
                <span class="link-name">Borrowing</span>
                </a>
                <span class="tooltip">Borrowing Form</span>
            </li>
        
            <li>
                <a href="../forms/transac.html" class="transition-link">
                <i class='bx bxs-info-square' ></i>
                <span class="link-name">Transactions</span>
                </a>
                <span class="tooltip">Daily Transaction</span>
            </li>
            <li>
                <a href="../forms/iteminv.html" class="transition-link">
                  <i class='bx bxs-book-content'></i>
                <span class="link-name">Inventory</span>
                </a>
                <span class="tooltip">Item Inventory</span>
              </li>
            
        </ul>
        <ul>
        <li class="log-out">
            <br />
          <br />
          <br />
          <br /> 
          <br />
            
            <a href="../php/logout.php">
            <i class='bx bx-log-out bx-rotate-180' ></i>
            <span class="link-name">Logout</span>
            </a>
        </li>
    </ul>
    </div>

    <div class="home-content">
        <img src="../pictures/clinic.png" class="clinic">

        <div class="content">
            <div class="desk">
                <img src="../pictures/nurse.png" class="nurse">
                <div class="greetings">
                    <h2 class="welcome">Welcome, Nurse</h2>
                    <p class="date" id="date">Date: 00/00/0000</p>
                    <p class="time" id="time">Monday | 00:00:00</p>
                </div>
            </div>

            <div class="item_summary">
                <div class="item_title">
                    <p>Item Summary</p>
                    <a href="#">See All</a>
                </div>
                <div class="item_chart">
                    <canvas id="itemChart" width="100%" height="80%" background-color="white"></canvas>
                </div>
            </div>

            <div class="notification">
                <div class="notif_title">
                    <p>Notification</p>
                    <a href="#">See All</a>
                </div>
                <div class="messages">
                    Notification Message
                </div>
            </div>

            <div class="emergency_hotline">
                <a href="#" class="hotlines" onclick="openForm()">
                    PASIG CITY EMERGENCY HOTLINES
                </a>
            </div>
            
            <div class="visit_summary">
                <div class="visit_title">
                    <p>Visit Summary</p>
                    <a href="#">See All</a>
                </div>
                <div class="visit_record">
                    <div class="visit_chart">
                        Line Graph Visit Summary
                    </div>

                    <div class="timedin_table">
                        <table>
                            <caption>Currently Time In</caption>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Time In</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Miah</td>
                                    <td>0/0/0 00:00</td>
                                    <td><button class="timedout">Time Out</button></td>
                                    
                                </tr>
                                <tr>
                                    <td>Miah</td>
                                    <td>0/0/0 00:00</td>
                                    <td><button class="timedout">Time Out</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div id="overlay" class="overlay"></div>
        <div class="hotlines_table" id="hotlines_table_popup">
            <a class="close_hotlines" onclick="closeForm()">x</a>
            <table>
                <caption>PASIG CITY EMERGENCY NUMBERS</caption>
                <thead >
                    <tr>
                        <th>DEPARTMENT</th>
                        <th>CONTACT NUMBER</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Emergency Hotline</td>
                        <td>(02) 8643 0000</td>
                    </tr>
                    <tr>
                        <td>Pasig City Fire Department</td>
                        <td>(02)</td>
                    </tr>
                    <tr>
                        <td>PNP Hotline</td>
                        <td>(02) 8477 7953</td>
                    </tr>
                    <tr>
                        <td>Pasig City Children's Hospital</td>
                        <td>(02) 8643 2222</td>
                    </tr>
                    <tr>
                        <td>Pasig City General Hospital</td>
                        <td>(02) 8643 3333 <br> (02) 8642 7379 <br> (02) 8642 7381 </td>
                    </tr>
                    <tr>
                        <td>National Emergency Hotline</td>
                        <td>911</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>


    <script>
        let btn = document.querySelector("#logo");
        let sidebar = document.querySelector(".sidebar");
    
        btn.onclick = function() {
            sidebar.classList.toggle("active");
        }
    </script>

    <script>
        function openForm() {
            document.getElementById("hotlines_table_popup").classList.add("show");
            document.getElementById("overlay").classList.add("show");
        }
    
        function closeForm() {
            document.getElementById("hotlines_table_popup").classList.remove("show");
            document.getElementById("overlay").classList.remove("show");
            
        }
    </script>

    <script>
        function updateDateTime() {
            const now = new Date();
        
            // Time formatting
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            const timeString = `${hours}:${minutes}:${seconds}`;
        
            // Date formatting
            const day = now.getDate().toString().padStart(2, '0');
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const year = now.getFullYear();
            const dateString = `${month}/${day}/${year}`;
        
            // Day of the week
            const weekdays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const weekday = weekdays[now.getDay()];
        
            // Update HTML content
            document.getElementById('date').innerText = `Date: ${dateString}`;
            document.getElementById('time').innerText = `${weekday} | ${timeString}`;
        }
    
        // Run every second
        setInterval(updateDateTime, 1000);
        updateDateTime(); // Initial call
    </script>

    <script>
        fetch('../php/item_summary.php')
        .then(response => {
            if (!response.ok) throw new Error("HTTP error! status: " + response.status);
            return response.json();
        })
        .then(data => {
            if (data.error) {
                console.error("PHP Error:", data);
                return;
            }

            const labels = data.map(item => item.label);
            const values = data.map(item => item.value);

            const backgroundColors = [
                '#4dc9f6', '#f67019', '#f53794',
                '#537bc4', '#acc236', '#166a8f',
                '#00a950', '#58595b', '#8549ba'
            ];

            const ctx = document.getElementById('itemChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Available Items',
                        data: values,
                        backgroundColor: backgroundColors,
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 20,
                                padding: 15
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    return `${label}: ${value} available`;
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Item Inventory Summary (Available Count)'
                        }
                    }
                }
            });
        })
        .catch(err => {
            console.error("Error loading item summary chart:", err);
            alert("Failed to load item summary chart. See console for details.");
        });

    </script>


</body>
</html>